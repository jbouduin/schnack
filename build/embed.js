!function(){"use strict";function n(n){var t,e="";n.user?(e+="\r\n  ",n.user.admin&&(e+='\r\n    <div class="schnack-settings">\r\n        <button class="schnack-action" data-target="notification" data-class="setting" data-action="true">'+(null==(t=n.partials.UnMute)?"":t)+'</button>\r\n        <button class="schnack-action" data-target="notification" data-class="setting" data-action="false">'+(null==(t=n.partials.Mute)?"":t)+"</button>\r\n    </div>\r\n  "),e+='\r\n  <div class="schnack-login-status">\r\n    '+(null==(t=n.partials.LoginStatus.replace("%USER%",n.user.name))?"":t)+'\r\n  </div>\r\n  <div class="schnack-above">\r\n    <div class="schnack-form">\r\n      <textarea class="schnack-body" placeholder="'+(null==(t=n.partials.PostComment)?"":t)+'"></textarea>\r\n      <blockquote class="schnack-body" style="display:none"></blockquote>\r\n      <br>\r\n      <button class="schnack-preview">'+(null==(t=n.partials.Preview)?"":t)+'</button>\r\n      <button style="display:none" class="schnack-write">'+(null==(t=n.partials.Edit)?"":t)+'</button>&nbsp;\r\n      <button class="schnack-send-comment schnack-button">'+(null==(t=n.partials.SendComment)?"":t)+'</button>&nbsp;\r\n      <button class="schnack-cancel-reply" style="display:none">'+(null==(t=n.partials.Cancel)?"":t)+"</button>\r\n    </div>\r\n  </div>\r\n"):(e+='\r\n  <div class="schnack-signin">\r\n    '+(null==(t=n.partials.SignInVia)?"":t)+"<br>\r\n      ",n.auth.forEach(function(a,s){e+="\r\n        "+(null==(t=s?n.partials.Or:"")?"":t)+'<button class="schnack-signin-'+(null==(t=a.id)?"":t)+'"><i class="icon schnack-icon-'+(null==(t=a.id)?"":t)+'"></i> '+(null==(t=a.name)?"":t)+"</button>\r\n      "}),e+="\r\n    "),e+="\r\n  </div>\r\n";var a=[];return n.replies={},n.comments.forEach(function(t){t.replyTo?(n.replies[t.replyTo]||(n.replies[t.replyTo]=[]),n.replies[t.replyTo].push(t)):a.push(t)}),n.comments=a,e+="\r\n"+(null==(t=n.comments_tpl(n))?"":t)+'\r\n<style type="text/css">\r\n  .schnack-action > * { pointer-events: none; }\r\n</style>\r\n'}function t(n){var t,e="";return e+='<ul class="schnack-comments">\r\n  ',n.comments.forEach(function(a){e+='\r\n    <li id="comment-'+(null==(t=a.id)?"":t)+'" data-id="'+(null==(t=a.id)?"":t)+'" class="schnack-comment',a.approved||a.trusted||(e+=" schnack-not-approved"),e+='">\r\n      <div class="schnack-comment-inner">\r\n        <div class="schnack-dateline">\r\n          <span class="schnack-author">\r\n            ',a.authorUrl&&(e+='\r\n              <a href="'+(null==(t=a.authorUrl)?"":t)+'" target="_blank">\r\n            '),e+="\r\n            "+(null==(t=a.author)?"":t)+"\r\n            ",a.authorUrl&&(e+="\r\n              </a>\r\n              "),e+="\r\n          </span>\r\n          ",n.user&&n.user.admin&&!a.authorTrusted&&["trust","block"].forEach(function(n){e+='\r\n            <button class="schnack-action" data-target="'+(null==(t=a.authorId)?"":t)+'" data-class="user" data-action="'+(null==(t=n)?"":t)+'">\r\n              <i class="icon schnack-icon-'+(null==(t=n)?"":t)+'"></i>\r\n              <span>\r\n                '+(null==(t=n)?"":t)+"\r\n              </span>\r\n            </button>\r\n          "}),e+='\r\n          <span class="schnack-date">\r\n            <a href="#comment-'+(null==(t=a.id)?"":t)+'">\r\n              '+(null==(t=a.created)?"":t)+'\r\n            </a>\r\n          </span>\r\n        </div>\r\n        <blockquote class="schnack-body">\r\n          '+(null==(t=a.comment)?"":t)+"\r\n        </blockquote>\r\n        ",a.approved||a.authorTrusted?n.user&&(e+='\r\n          <button class="schnack-reply" data-reply-to="'+(null==(t=a.id)?"":t)+'">'+(null==(t=n.partials.Reply)?"":t)+"</button>\r\n        "):(e+='\r\n          <div class="schnack-awaiting-approval">\r\n            ',n.user&&n.user.admin&&["approve","reject"].forEach(function(n){e+='\r\n              <button class="schnack-action" data-target="'+(null==(t=a.id)?"":t)+'" data-class="comment" data-action="'+(null==(t=n)?"":t)+'">\r\n                <i class="icon schnack-icon-'+(null==(t=n)?"":t)+'"></i>\r\n                <span>\r\n                  '+(null==(t=n)?"":t)+"\r\n                </span>\r\n              </button>\r\n            "}),e+="\r\n            "+(null==(t=n.user&&n.user.admin?n.partials.AdminApproval:n.partials.WaitingForApproval)?"":t)+"\r\n          </div>\r\n        "),e+="\r\n      </div>\r\n      ",n.replies[a.id]&&(n.comments=n.replies[a.id],e+="\r\n        "+(null==(t=n.comments_tpl(n))?"":t)+"\r\n      "),e+="\r\n    </li>\r\n  "}),e+="\r\n</ul>\r\n"}var e="function"==typeof fetch?fetch.bind():function(n,t){return t=t||{},new Promise(function(e,a){function s(){var n,t=[],e=[],a={};return r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(s,r,i){t.push(r=r.toLowerCase()),e.push([r,i]),n=a[r],a[r]=n?n+","+i:i}),{ok:2==(r.status/100|0),status:r.status,statusText:r.statusText,url:r.responseURL,clone:s,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},headers:{keys:function(){return t},entries:function(){return e},get:function(n){return a[n.toLowerCase()]},has:function(n){return n.toLowerCase()in a}}}}var r=new XMLHttpRequest;r.open(t.method||"get",n,!0);for(var i in t.headers)r.setRequestHeader(i,t.headers[i]);r.withCredentials="include"==t.credentials,r.onload=function(){e(s())},r.onerror=a,r.send(t.body||null)})},a=function(n){return document.querySelector(n)},s=function(n){return document.querySelectorAll(n)},r=function(n){this.options=n,this.options.endpoint=n.host+"/comments/"+n.slug,this.initialized=!1,this.firstLoad=!0;var t=new URL(n.host);"localhost"!==t.hostname&&(document.domain=t.hostname.split(".").slice(1).join(".")),this.refresh()};r.prototype.refresh=function(){var r=this,i=this.options,o=i.target,c=i.slug,l=i.host,u=i.endpoint,d=i.partials;e(u,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(i){i.comments_tpl=t,i.partials=d,a(o).innerHTML=n(i);var h=a(o+" div.schnack-above"),p=a(o+" div.schnack-form"),m=a(o+" textarea.schnack-body"),f=a(o+" .schnack-form blockquote.schnack-body"),v=window.localStorage.getItem("schnack-draft-"+c);v&&m&&(m.value=v);var k=a(o+" .schnack-button"),y=a(o+" .schnack-preview"),b=a(o+" .schnack-write"),g=a(o+" .schnack-cancel-reply"),w=s(o+" .schnack-reply");if(k&&(k.addEventListener("click",function(n){var t=m.value;e(u,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:t,replyTo:p.dataset.reply})}).then(function(n){return n.json()}).then(function(n){m.value="",window.localStorage.setItem("schnack-draft-"+c,m.value),n.id&&(r.firstLoad=!0,window.location.hash="#comment-"+n.id),r.refresh()})}),y.addEventListener("click",function(n){var t=m.value;m.style.display="none",y.style.display="none",f.style.display="block",b.style.display="inline",e(l+"/markdown",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:t})}).then(function(n){return n.json()}).then(function(n){f.innerHTML=n.html})}),b.addEventListener("click",function(n){m.style.display="inline",y.style.display="inline",f.style.display="none",b.style.display="none"}),m.addEventListener("keyup",function(){window.localStorage.setItem("schnack-draft-"+c,m.value)}),w.forEach(function(n){n.addEventListener("click",function(){p.dataset.reply=n.dataset.replyTo,g.style.display="inline-block",n.parentElement.appendChild(p)})}),g.addEventListener("click",function(){h.appendChild(p),delete p.dataset.reply,g.style.display="none"})),i.user){var S=a("a.schnack-signout");S&&S.addEventListener("click",function(n){n.preventDefault(),e(l+"/auth/signout",{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(){return r.refresh()})})}else i.auth.forEach(function(n){var t=a(o+" .schnack-signin-"+n.id);t&&t.addEventListener("click",function(t){if("anonymous"===n.id){var e=document.createElement("form");e.setAttribute("method","POST"),e.setAttribute("action",l+"/auth/"+n.id);var a=function(n,t){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",n),a.setAttribute("value",t),e.appendChild(a)};a("username","dummy"),a("password","dummy");var s=window.open();window.__schnack_wait_for_oauth=function(){s.close(),r.refresh()},s.document.body.appendChild(e),e.submit()}else!function(t){void 0===t&&(t="");var e=window.open(l+"/auth/"+n.id+(t?"/d/"+t:""),n.name+" Sign-In","resizable,scrollbars,status,width=600,height=500");window.__schnack_wait_for_oauth=function(){e.close(),r.refresh()}}()})});if(i.user&&i.user.admin){if(!r.initialized){var E=document.createElement("script");E.setAttribute("src",l+"/push.js"),document.head.appendChild(E),r.initialized=!0}var T=function(n){var t=n.target.dataset;e(l+"/"+t.class+"/"+t.target+"/"+t.action,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:""}).then(function(){return r.refresh()})};document.querySelectorAll(".schnack-action").forEach(function(n){n.addEventListener("click",T)})}if(r.firstLoad&&window.location.hash.match(/^#comment-\d+$/)){var L=document.querySelector(window.location.hash);L.scrollIntoView(),L.classList.add("schnack-highlight"),r.firstLoad=!1}})},function(){var n=document.querySelector("script[data-schnack-target]");if(!n)return console.warn("schnack script tag needs some data attributes");var t=n.dataset,e=t.schnackSlug,a=new URL(n.getAttribute("src")),s=a.protocol+"//"+a.host,i={Preview:"Preview",Edit:"Edit",SendComment:"Send comment",Cancel:"Cancel",Or:"Or",Mute:"mute notifications",UnMute:"unmute",PostComment:"Post a comment. Markdown is supported!",AdminApproval:"This comment is still waiting for your approval",WaitingForApproval:"Your comment is still waiting for approval by the site owner",SignInVia:"To post a comment you need to sign in via",Reply:"<i class='icon schnack-icon-reply'></i> reply",LoginStatus:"(signed in as <span class='schnack-user'>@%USER%</span> :: <a class='schnack-signout' href='#'>sign out</a>)"};Object.keys(i).forEach(function(t){n.dataset["schnackPartial"+t]&&(i[t]=n.dataset["schnackPartial"+t])}),new r({target:t.schnackTarget,slug:e,host:s,partials:i})}()}();
